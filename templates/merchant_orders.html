{% extends "base.html" %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi-clipboard-data" style="color: #fd7e14;"></i> è¨‚å–®ç®¡ç†</h2>
    </div>
    
    <div class="row">
        <div class="col-12">
            {% if orders %}
                {% for order in orders %}
                <div class="card mb-3 shadow-sm {{ 'border-warning' if order.order_status == 'pending' else '' }}">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <strong>è¨‚å–® #{{ order.order_id }}</strong>
                            <span class="text-muted mx-2">|</span>
                            <i class="bi-person-circle"></i> {{ customer_map[order.customer_id].user_name }}
                            <span class="text-muted small">({{ order.order_time.strftime('%Y-%m-%d %H:%M') }})</span>
                        </div>
                        
                        <div>
                            {% if order.order_status == 'pending' %}
                                <span class="badge bg-warning text-dark">ç­‰å¾…æ¥å–®</span>
                            {% elif order.order_status == 'accepted' %}
                                <span class="badge" style="background-color: #fd7e14;">è£½ä½œä¸­</span>
                            {% elif order.order_status == 'completed' %}
                                <span class="badge bg-success">å·²å®Œæˆ</span>
                            {% elif order.order_status == 'rejected' %}
                                <span class="badge bg-danger">å·²æ‹’çµ•</span>
                            {% elif order.order_status == 'cancelled' %}
                                <span class="badge bg-secondary">é¡§å®¢å·²å–æ¶ˆ</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush mb-3">
                            {% for item in order.order_cart %}
                                {% set food = food_map.get(item[0]) %}
                                {% if food %}
                                <li class="list-group-item d-flex justify-content-between px-0 py-1 border-0">
                                    <span>{{ food.food_name }} x <strong>{{ item[1] }}</strong></span>
                                    <span>${{ food.food_price * item[1] }}</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                        <div class="d-flex justify-content-between align-items-center border-top pt-2">
                            <h5 class="fw-bold">ç¸½è¨ˆ: ${{ order.total_price }}</h5>
                            
                            <div>
                                {% if order.order_status == 'pending' %}
                                    <a href="{{ url_for('merchant_order_action', order_id=order.order_id, action='accept') }}" 
                                       class="btn text-white btn-sm"
                                       style="background-color: #fd7e14; border-color: #fd7e14;">
                                        <i class="bi-check-lg"></i> æ¥å–®
                                    </a>
                                    <a href="{{ url_for('merchant_order_action', order_id=order.order_id, action='reject') }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('ç¢ºå®šè¦æ‹’çµ•é€™ç­†è¨‚å–®å—ï¼Ÿ');">
                                        <i class="bi-x-lg"></i> æ‹’çµ•
                                    </a>
                                {% elif order.order_status == 'accepted' %}
                                    <a href="{{ url_for('merchant_order_action', order_id=order.order_id, action='complete') }}" 
                                       class="btn text-white btn-sm"
                                       style="background-color: #fd7e14; border-color: #fd7e14;">
                                        <i class="bi-bicycle"></i> å®Œæˆè¨‚å–® / é…é€
                                    </a>
                                {% else %}
                                    <button class="btn btn-secondary btn-sm" disabled>å·²çµæ¡ˆ</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="alert alert-info text-center p-5">
                    <h4>ç›®å‰æ²’æœ‰ä»»ä½•è¨‚å–® ğŸ“­</h4>
                    <p>åˆ¥æ“”å¿ƒï¼Œç¾é£Ÿç¸½æœƒæœ‰äººæ¬£è³çš„ï¼</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}